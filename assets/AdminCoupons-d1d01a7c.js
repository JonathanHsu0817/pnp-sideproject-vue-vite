import{S as h}from"./sweetalert2.all-492a50e4.js";import{M as k,D as L}from"./DelModal-c17349b2.js";import{_ as V,r,o as d,c as u,d as i,w as M,b as e,n as f,f as $,H as x,F as y,k as I,t as b}from"./index-f10cf98c.js";import{_ as D}from"./loading-0268191f.js";import{P as S}from"./PaginationComponent-cfd4c634.js";import"./base-component-e4e006c9.js";import"./component-functions-583109cb.js";const T={props:["tempCoupon","isNew"],emits:["updateCoupon"],data(){return{isLoading:!1,couponModal:"",due_date:"",innerCoupon:{}}},methods:{show(){this.couponModal.show()},hide(){this.couponModal.hide()},ltToday(n){const[t]=new Date().toISOString().split("T");return n>=t||this.innerCoupon.id?!0:"到期日 不可小於今日"}},mounted(){this.couponModal=new k(this.$refs.couponModal,{keyboard:!1})},watch:{tempCoupon(){this.innerCoupon=this.tempCoupon;const n=new Date(this.innerCoupon.due_date*1e3).toISOString().split("T");Array.isArray(n)&&([this.due_date]=n)},due_date(){this.innerCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}}},A=e("img",{src:D,alt:""},null,-1),P={id:"couponModal",ref:"couponModal",class:"modal fade",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},E={class:"modal-dialog"},U={class:"modal-content border-0"},B={class:"modal-header bg-dark text-white"},N={id:"couponModalLabel",class:"modal-title"},F={key:0},R={key:1},O=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),q={class:"modal-body"},H={class:"mb-3"},j=e("label",{for:"title"},"標題",-1),z={class:"mb-3"},G=e("label",{for:"code"},"優惠碼",-1),J={class:"mb-3"},K=e("label",{for:"due_date"},"到期日",-1),Q={class:"mb-3"},W=e("label",{for:"price"},"折扣百分比",-1),X={class:"mb-3"},Y={class:"form-check"},Z=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),ee=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 "),e("button",{type:"submit",class:"btn btn-dark"}," 確認 ")],-1);function te(n,t,m,_,o,l){const v=r("VueLoading"),c=r("VField"),p=r("ErrorMessage"),w=r("VForm");return d(),u(y,null,[i(v,{active:o.isLoading},{default:M(()=>[A]),_:1},8,["active"]),e("div",P,[e("div",E,[e("div",U,[e("div",B,[e("h5",N,[m.isNew?(d(),u("span",F,"新增優惠卷")):(d(),u("span",R,"編輯優惠卷"))]),O]),i(w,{ref:"form",onSubmit:t[5]||(t[5]=s=>n.$emit("updateCoupon",o.innerCoupon))},{default:M(({errors:s})=>[e("div",q,[e("div",H,[j,i(c,{id:"title",name:"標題",type:"text",class:f(["form-control",{"is-invalid":s.標題}]),placeholder:"請輸入標題",rules:"required",modelValue:o.innerCoupon.title,"onUpdate:modelValue":t[0]||(t[0]=a=>o.innerCoupon.title=a)},null,8,["class","modelValue"]),i(p,{name:"標題",class:"invalid-feedback"})]),e("div",z,[G,i(c,{id:"code",name:"優惠碼",type:"text",class:f(["form-control",{"is-invalid":s.優惠碼}]),placeholder:"請輸入優惠碼",rules:"required",modelValue:o.innerCoupon.code,"onUpdate:modelValue":t[1]||(t[1]=a=>o.innerCoupon.code=a)},null,8,["class","modelValue"]),i(p,{name:"優惠碼",class:"invalid-feedback"})]),e("div",J,[K,i(c,{id:"due_date",name:"到期日",type:"date",class:f(["form-control",{"is-invalid":s.到期日}]),placeholder:"請輸入到期日",rules:l.ltToday,modelValue:o.due_date,"onUpdate:modelValue":t[2]||(t[2]=a=>o.due_date=a)},null,8,["class","rules","modelValue"]),i(p,{name:"到期日",class:"invalid-feedback"})]),e("div",Q,[W,i(c,{id:"price",name:"折扣百分比",type:"number",class:f(["form-control",{"is-invalid":s.折扣百分比}]),placeholder:"請輸入折扣百分比",rules:"required|min_value:0|max_value:100|numeric|integer",modelValue:o.innerCoupon.percent,"onUpdate:modelValue":t[3]||(t[3]=a=>o.innerCoupon.percent=a),modelModifiers:{number:!0},min:"0",max:"100"},null,8,["class","modelValue"]),i(p,{name:"折扣百分比",class:"invalid-feedback"})]),e("div",X,[e("div",Y,[$(e("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[4]||(t[4]=a=>o.innerCoupon.is_enabled=a),id:"is_enabled"},null,512),[[x,o.innerCoupon.is_enabled]]),Z])])]),ee]),_:1},512)])])],512)],64)}const oe=V(T,[["render",te]]),{VITE_API_URL:g,VITE_API_PATH:C}={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"blacknwhiterabbit",BASE_URL:"/pnp-sideproject-vue-vite/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},ne={components:{CouponModal:oe,DelModal:L,pagination:S},data(){return{isLoading:!1,coupons:[],isNew:"",tempCoupon:{},pagination:{},pageNum:1}},methods:{getCouponsData(n=1){this.isLoading=!0,this.$http.get(`${g}/api/${C}/admin/coupons?page=${n}`).then(t=>{this.coupons=t.data.coupons,this.pagination=t.data.pagination,this.isLoading=!1}).catch(t=>{h.fire({icon:"error",title:t.response.data.message,showConfirmButton:!1,timer:1500}),this.isLoading=!1})},updateCouponData(n){this.isLoading=!0;let t=`${g}/api/${C}/admin/coupon`,m="post",_=n;this.isNew||(t=`${g}/api/${C}/admin/coupon/${this.tempCoupon.id}`,m="put",_=this.tempCoupon),this.$http[m](t,{data:_}).then(o=>{this.$refs.couponModal.hide(),h.fire({icon:"success",title:o.data.message,showConfirmButton:!1,timer:1500}),this.getCouponsData(),this.isLoading=!1}).catch(o=>{h.fire({icon:"error",title:o.response.data.message,showConfirmButton:!1,timer:1500}),this.isLoading=!1})},deleteCoupon(){this.isLoading=!0,this.$http.delete(`${g}/api/${C}/admin/coupon/${this.tempCoupon.id}`,{data:this.tempCoupon}).then(n=>{this.$refs.delModal.hide(),h.fire({icon:"success",title:n.data.message,showConfirmButton:!1,timer:1500}),this.getCouponsData(this.pageNum),this.isLoading=!1}).catch(n=>{h.fire({icon:"error",title:n.response.data.message,showConfirmButton:!1,timer:1500}),this.isLoading=!1})},openModal(n,t){this.isNew=n,n==="create"?(this.tempCoupon={is_enabled:0,due_date:new Date().getTime()/1e3},this.isNew=!0,this.$refs.couponModal.show()):n==="edit"?(this.tempCoupon={...t},this.isNew=!1,this.$refs.couponModal.show()):n==="delete"&&(this.tempCoupon={...t},this.$refs.delModal.show())},date(n){return new Date(n*1e3).toLocaleDateString()}},mounted(){this.getCouponsData()}},se=e("img",{src:D,alt:""},null,-1),ie={class:"container"},ae={class:"text-end mt-4"},le={class:"table table-hover mt-4"},de=e("thead",null,[e("tr",{class:"align-middle"},[e("th",{width:"120"},"標題"),e("th",null,"優惠碼"),e("th",null,"折扣百分比"),e("th",{width:"120"}," 到期日 "),e("th",{width:"120"}," 是否啟用 "),e("th",{width:"120"}," 編輯 ")])],-1),ue={key:0,class:"text-success"},re={key:1},ce={class:"btn-group"},pe=["onClick"],me=["onClick"];function he(n,t,m,_,o,l){const v=r("VueLoading"),c=r("pagination"),p=r("CouponModal"),w=r("DelModal");return d(),u(y,null,[i(v,{active:o.isLoading},{default:M(()=>[se]),_:1},8,["active"]),e("div",ie,[e("div",ae,[e("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=s=>l.openModal("create"))}," 建立新的優惠券 ")]),e("table",le,[de,e("tbody",null,[(d(!0),u(y,null,I(o.coupons,s=>(d(),u("tr",{key:s.id,class:"align-middle"},[e("td",null,b(s.title),1),e("td",null,b(s.code),1),e("td",null,b(`${s.percent} %`),1),e("td",null,b(l.date(s.due_date)),1),e("td",null,[s.is_enabled?(d(),u("span",ue,"啟用")):(d(),u("span",re,"未啟用"))]),e("td",null,[e("div",ce,[e("button",{type:"button",class:"btn btn-outline-secondary btn-sm",onClick:a=>l.openModal("edit",s)}," 編輯 ",8,pe),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:a=>l.openModal("delete",s)}," 刪除 ",8,me)])])]))),128))])]),i(c,{pagination:o.pagination,"get-items":l.getCouponsData,onChangePage:l.getCouponsData},null,8,["pagination","get-items","onChangePage"])]),i(p,{ref:"couponModal","temp-coupon":o.tempCoupon,"is-new":o.isNew,onUpdateCoupon:l.updateCouponData},null,8,["temp-coupon","is-new","onUpdateCoupon"]),i(w,{ref:"delModal","temp-item":o.tempCoupon,onDeleteItem:l.deleteCoupon},null,8,["temp-item","onDeleteItem"])],64)}const Me=V(ne,[["render",he]]);export{Me as default};
