import{S as c}from"./sweetalert2.all-ef8e7809.js";import{M as x,D as L}from"./DelModal-a1bae0f7.js";import{_ as y,r as h,o as d,c as i,b as t,d as l,w as V,f,v as g,F as w,k as M,n as b,H as C,l as A,t as P,a as E}from"./index-897449d8.js";import{P as T}from"./PaginationComponent-f65ecbb6.js";import{_ as $}from"./loading-0268191f.js";import"./base-component-ad20424d.js";import"./component-functions-895676b4.js";const{VITE_API_URL:B,VITE_API_PATH:R}={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_API_PATH:"blacknwhiterabbit",BASE_URL:"/pnp-sideproject-vue-vite/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},S={props:["tempProduct","isNew"],data(){return{productModal:""}},methods:{uploadFile(){const o=new FormData;o.append("file-to-upload",this.$refs.fileInput.files[0]);const e=`${B}/api/${R}/admin/upload`;c.fire({title:"上傳圖片中",timer:2e3,timerProgressBar:!0,didOpen:()=>{c.showLoading()},willClose:()=>{this.$http.post(e,o,{headers:{"Content-Type":"multipart/form-data"}}).then(r=>{r.data.success&&(this.modalProductData.imageUrl=r.data.imageUrl),this.$refs.fileInput.value=""}).catch(r=>{c.fire({icon:"error",title:r.response.data.message}),this.$refs.fileInput.value=""})}})},createImagesUrl(){this.modalProductData.imagesUrl||(this.modalProductData.imagesUrl=[]),this.modalProductData.imagesUrl.push("")},deleteImagesUrl(){this.modalProduct.imagesUrl.pop()},show(){this.productModal.show()},hide(){this.productModal.hide()}},mounted(){this.productModal=new x(this.$refs.productModal)},computed:{modalProductData(){return this.tempProduct}}},N={id:"productModal",ref:"productModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},F={class:"modal-dialog modal-xl"},H={class:"modal-content border-0"},q={class:"modal-header bg-dark text-white"},z={id:"productModalLabel",class:"modal-title"},O={key:0},j={key:1},G=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),J={class:"modal-body"},K={class:"row"},Q={class:"col-sm-4"},W={class:"mb-3"},X=t("label",{for:"imageUrl",class:"form-label"},"主要圖片",-1),Y={class:"mb-3"},Z=t("label",{for:"uploadFile",class:"form-label"},"或 上傳圖片",-1),tt=["src"],et=t("h3",{class:"mb-3"},"多圖新增",-1),at=t("label",{for:"imagesUrl",class:"form-label"},"圖片網址",-1),st=["onUpdate:modelValue"],ot=["src"],lt={key:0},dt={key:1},it={class:"col-sm-8"},rt={class:"mb-3"},nt=t("label",{for:"title",class:"form-label"},"標題",-1),ct={class:"row"},mt={class:"mb-3 col-md-6"},ut=t("label",{for:"category",class:"form-label"},"分類",-1),pt={class:"mb-3 col-md-6"},ht=t("label",{for:"price",class:"form-label"},"單位",-1),_t={class:"row"},ft={class:"mb-3 col-md-6"},bt=t("label",{for:"origin_price",class:"form-label"},"原價",-1),gt={class:"mb-3 col-md-6"},Pt=t("label",{for:"price",class:"form-label"},"售價",-1),vt=t("hr",null,null,-1),Dt={class:"mb-3"},Ut=t("label",{for:"description",class:"form-label"},"產品描述",-1),wt={class:"mb-3"},yt=t("label",{for:"content",class:"form-label"},"說明內容",-1),Vt={class:"mb-3"},Mt={class:"form-check"},It=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),kt=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 "),t("button",{type:"submit",class:"btn btn-primary"}," 確認 ")],-1);function xt(o,e,r,I,m,a){const u=h("v-field"),p=h("ErrorMessage"),U=h("v-form");return d(),i("div",N,[t("div",F,[t("div",H,[t("div",q,[t("h5",z,[r.isNew?(d(),i("span",O,"新增產品")):(d(),i("span",j,"編輯產品"))]),G]),l(U,{ref:"form",onSubmit:e[12]||(e[12]=n=>o.$emit("updateProduct",a.modalProductData))},{default:V(({errors:n})=>[t("div",J,[t("div",K,[t("div",Q,[t("div",W,[X,f(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>a.modalProductData.imageUrl=s),type:"text",class:"form-control mb-2",id:"imageUrl",placeholder:"請輸入圖片連結"},null,512),[[g,a.modalProductData.imageUrl]])]),t("div",Y,[Z,t("input",{type:"file",id:"uploadFile",class:"form-control",ref:"fileInput",onChange:e[1]||(e[1]=(...s)=>a.uploadFile&&a.uploadFile(...s))},null,544)]),t("img",{class:"img-fluid mb-3",src:a.modalProductData.imageUrl},null,8,tt),et,(d(!0),i(w,null,M(a.modalProductData.imagesUrl,(s,_)=>(d(),i("div",{class:"mb-3",key:_},[at,f(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結",id:"imagesUrl","onUpdate:modelValue":k=>a.modalProductData.imagesUrl[_]=k},null,8,st),[[g,a.modalProductData.imagesUrl[_]]]),t("img",{class:"img-fluid",src:a.modalProductData.imagesUrl[_]},null,8,ot)]))),128)),!a.modalProductData.imagesUrl||!a.modalProductData.imagesUrl.length||a.modalProductData.imagesUrl[a.modalProductData.imagesUrl.length-1]?(d(),i("div",lt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[2]||(e[2]=(...s)=>a.createImagesUrl&&a.createImagesUrl(...s))}," 新增圖片 ")])):(d(),i("div",dt,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm d-block w-100",onClick:e[3]||(e[3]=(...s)=>a.deleteImagesUrl&&a.deleteImagesUrl(...s))}," 刪除圖片 ")]))]),t("div",it,[t("div",rt,[nt,l(u,{id:"title",name:"標題",type:"text",class:b(["form-control",{"is-invalid":n.標題}]),placeholder:"請輸入標題",modelValue:a.modalProductData.title,"onUpdate:modelValue":e[4]||(e[4]=s=>a.modalProductData.title=s),rules:"required"},null,8,["modelValue","class"]),l(p,{name:"標題",class:"invalid-feedback"})]),t("div",ct,[t("div",mt,[ut,l(u,{id:"category",name:"分類",type:"text",class:b(["form-control",{"is-invalid":n.分類}]),placeholder:"請輸入分類",modelValue:a.modalProductData.category,"onUpdate:modelValue":e[5]||(e[5]=s=>a.modalProductData.category=s),rules:"required"},null,8,["modelValue","class"]),l(p,{name:"分類",class:"invalid-feedback"})]),t("div",pt,[ht,l(u,{id:"unit",name:"單位",type:"text",class:b(["form-control",{"is-invalid":n.單位}]),placeholder:"請輸入單位",modelValue:a.modalProductData.unit,"onUpdate:modelValue":e[6]||(e[6]=s=>a.modalProductData.unit=s),rules:"required"},null,8,["modelValue","class"]),l(p,{name:"單位",class:"invalid-feedback"})])]),t("div",_t,[t("div",ft,[bt,l(u,{id:"origin_price",name:"原價",type:"number",class:b(["form-control",{"is-invalid":n.原價}]),placeholder:"請輸入原價",modelValue:a.modalProductData.origin_price,"onUpdate:modelValue":e[7]||(e[7]=s=>a.modalProductData.origin_price=s),modelModifiers:{number:!0},min:"0",rules:"required|min_value:0|numeric|integer"},null,8,["modelValue","class"]),l(p,{name:"原價",class:"invalid-feedback"})]),t("div",gt,[Pt,l(u,{id:"price",name:"售價",type:"number",class:b(["form-control",{"is-invalid":n.售價}]),placeholder:"請輸入售價",modelValue:a.modalProductData.price,"onUpdate:modelValue":e[8]||(e[8]=s=>a.modalProductData.price=s),modelModifiers:{number:!0},min:"0",rules:"required|min_value:0|numeric|integer"},null,8,["modelValue","class"]),l(p,{name:"售價",class:"invalid-feedback"})])]),vt,t("div",Dt,[Ut,f(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":e[9]||(e[9]=s=>a.modalProductData.description=s)},`\r
                    `,512),[[g,a.modalProductData.description]])]),t("div",wt,[yt,f(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":e[10]||(e[10]=s=>a.modalProductData.content=s)},`\r
                    `,512),[[g,a.modalProductData.content]])]),t("div",Vt,[t("div",Mt,[f(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[11]||(e[11]=s=>a.modalProductData.is_enabled=s)},null,512),[[C,a.modalProductData.is_enabled]]),It])])])])]),kt]),_:1},512)])])],512)}const Lt=y(S,[["render",xt]]),{VITE_API_URL:v,VITE_API_PATH:D}={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_API_PATH:"blacknwhiterabbit",BASE_URL:"/pnp-sideproject-vue-vite/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},Ct={components:{Pagination:T,DelModal:L,ProductModal:Lt},data(){return{tempProduct:{imagesUrl:[]},products:[],isNew:!1,pagination:{},productModal:"",isLoading:!1}},methods:{getProductsData(o=1){this.isLoading=!0,this.$http.get(`${v}api/${D}/admin/products/?page=${o}`).then(e=>{this.products=e.data.products,this.pagination=e.data.pagination,this.isLoading=!1}).catch(e=>{c.fire({icon:"error",title:e.response.data.message,showConfirmButton:!1,timer:1500}),this.isLoading=!1})},updateProductsData(){this.isLoading=!0;let o=`${v}api/${D}/admin/product`,e="post";this.isNew||(o=`${v}api/${D}/admin/product/${this.tempProduct.id}`,e="put"),this.$http[e](o,{data:this.tempProduct}).then(r=>{this.$refs.productModal.hide(),c.fire({icon:"success",title:r.data.message,showConfirmButton:!1,timer:1500}),this.getProductsData(),this.isLoading=!1}).catch(r=>{c.fire({icon:"error",title:r.response.data.message,showConfirmButton:!1,timer:1500}),this.isLoading=!1})},delProduct(){this.isLoading=!0;const o=`${v}api/${D}/admin/product/${this.tempProduct.id}`;this.$http.delete(o).then(e=>{this.$refs.delModal.hide(),c.fire({icon:"success",title:e.data.message,showConfirmButton:!1,timer:1500}),this.getProductsData(),this.isLoading=!1}).catch(e=>{c.fire({icon:"error",title:e.response.data.message,showConfirmButton:!1,timer:1500}),this.isLoading=!1})},openModal(o,e){o==="new"?(this.tempProduct={imagesUrl:[]},this.isNew=!0,this.$refs.productModal.show()):o==="edit"?(this.tempProduct={...e},this.isNew=!1,this.$refs.productModal.show()):o==="delete"&&(this.tempProduct={...e},this.$refs.delModal.show())}},mounted(){this.getProductsData()}},At=t("img",{src:$,alt:""},null,-1),Et={class:"container"},Tt={class:"text-end mt-4"},$t={class:"card shadow-sm rounded-top mt-4"},Bt=A('<div class="card-header bg-transparent pb-1"><div class="input-group"><span class="input-group-text border-0 bg-transparent ps-8 pe-1"><i class="bi bi-search"></i></span><input type="search" class="form-control border-0 shadow-none"></div></div>',1),Rt={class:"card-body p-0"},St={class:"table-responsive"},Nt={class:"table table-hover mb-0"},Ft=t("thead",{class:"bg-primary-light"},[t("tr",{class:"align-middle"},[t("th",{scope:"col",class:"ps-4"}),t("th",{scope:"col",class:"py-3"},"分類"),t("th",{scope:"col"},"產品名稱"),t("th",{scope:"col"},"原價"),t("th",{scope:"col"},"售價"),t("th",{scope:"col"},"是否啟用"),t("th",{scope:"col",class:"pe-2"},"編輯")])],-1),Ht={class:"text-nowrap"},qt=t("td",null,null,-1),zt={key:0,class:"text-success"},Ot={key:1},jt={class:"pe-2"},Gt={class:"btn-group"},Jt=["onClick"],Kt=t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",class:"bi bi-pencil",viewBox:"0 0 16 16"},[t("path",{d:"M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"})],-1),Qt=["onClick"],Wt={class:"card-footer bg-transparent -mt-xs-1"};function Xt(o,e,r,I,m,a){const u=h("VueLoading"),p=h("Pagination"),U=h("ProductModal"),n=h("DelModal");return d(),i(w,null,[l(u,{active:m.isLoading},{default:V(()=>[At]),_:1},8,["active"]),t("div",Et,[t("div",Tt,[t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=s=>a.openModal("new"))}," 建立新的產品 ")]),t("div",$t,[Bt,t("div",Rt,[t("div",St,[t("table",Nt,[Ft,t("tbody",Ht,[(d(!0),i(w,null,M(m.products,s=>(d(),i("tr",{class:"align-middle",key:s.id},[qt,t("td",null,P(s.category),1),t("td",null,P(s.title),1),t("td",null,P(s.origin_price),1),t("td",null,P(s.price),1),t("td",null,[s.is_enabled==1?(d(),i("span",zt,"啟用")):(d(),i("span",Ot,"未啟用"))]),t("td",jt,[t("div",Gt,[t("button",{type:"button",class:"btn btn-outline-secondary btn-sm",onClick:_=>a.openModal("edit",s)},[E(" 編輯 "),Kt],8,Jt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:_=>a.openModal("delete",s)}," 刪除 ",8,Qt)])])]))),128))])])])]),t("div",Wt,[l(p,{pagination:m.pagination,"get-items":a.getProductsData,onChangePage:a.getProductsData},null,8,["pagination","get-items","onChangePage"])])])]),l(U,{ref:"productModal","temp-product":m.tempProduct,"is-new":m.isNew,onUpdateProduct:a.updateProductsData},null,8,["temp-product","is-new","onUpdateProduct"]),l(n,{ref:"delModal","temp-item":m.tempProduct,onDeleteItem:a.delProduct},null,8,["temp-item","onDeleteItem"])],64)}const le=y(Ct,[["render",Xt]]);export{le as default};
