import{T as _}from"./toast-ed0faeed.js";import{S as E}from"./sweetalert2.all-492a50e4.js";import{_ as P,i as U,m as F,r as c,o as i,c as n,d,w as k,b as e,F as h,k as N,j as b,f as g,v,a as y,n as m,t as f}from"./index-f10cf98c.js";import{c as C}from"./cartStore-73015a53.js";import{R}from"./RecommendSwiper-726dac8b.js";import{T as A}from"./TimeLine-5158981a.js";import{_ as q}from"./loading-0268191f.js";import"./productsStore-751cc10c.js";const{VITE_API_URL:V,VITE_API_PATH:w}={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"blacknwhiterabbit",BASE_URL:"/pnp-sideproject-vue-vite/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},j={data(){return{isLoading:!1,form:{user:{name:"",email:"",tel:"",address:""},message:""},couponCode:"",step:1}},components:{RecommendSwiper:R,TimeLine:A},computed:{...U(C,["carts","total","final_total","loadingItem"])},methods:{...F(C,["getCart","updateCart"]),createOrder(){this.isLoading=!0,this.$http.post(`${V}/api/${w}/order`,{data:this.form}).then(s=>{this.$refs.form.resetForm(),this.form={user:{name:"",email:"",tel:"",address:""},message:""},this.getCart(),_(s.data.message,"success"),this.$router.push(`payment/${s.data.orderId}`),this.isLoading=!1}).catch(s=>{E.fire({icon:"error",title:s.response.data.message,showConfirmButton:!1,timer:1500}),this.isLoading=!1})},addCouponCode(){this.loadingItem=this.couponCode,this.$http.post(`${V}/api/${w}/coupon`,{data:{code:this.couponCode}}).then(s=>{this.getCart(),_(s.data.message,"success"),this.loadingItem=""}).catch(s=>{_(s.response.data.message,"error"),this.loadingItem=""})},updateProduct(s,o){s==="remove"?o.qty-=1:o.qty+=1,this.updateCart(o)},isPhone(s){return/^(09)[0-9]{8}$/.test(s)?!0:"需要正確的手機號碼"},priceFormat(s){return s.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}}},B=e("img",{src:q,alt:""},null,-1),I={class:"bg-backStage py-5 min-height"},D={class:"container"},M={class:"mb-9"},O={class:"row"},H={class:"col-lg-6 p-5"},z=e("h2",{class:"mb-6"},"確認訂單內容",-1),$={key:0,class:"mb-10 ps-0"},G={class:"col overflow-hidden"},J=["src","alt"],K={class:"col-8"},Q={class:"d-flex justify-content-between align-items-center"},W={class:"fs-7 fs-md-5 mb-2"},X=["onClick","disabled"],Y={key:0,class:"fas fa-spinner fa-pulse"},Z={key:1,class:"fas fa-trash-alt text-primary fs-5"},ee={class:"d-flex justify-content-between align-items-center"},se={class:"text-primary fs-md-6"},te=e("span",{class:"fs-9 fs-md-8"},"NT$ ",-1),oe={class:"d-flex align-items-center w-auto"},le=["onClick"],ae=e("i",{class:"fas fa-minus"},null,-1),ie=[ae],ne=["onUpdate:modelValue"],de=["onClick"],re=e("i",{class:"fas fa-plus"},null,-1),ce=[re],me={class:"input-group mb-3 input-group-sm"},ue={key:0,type:"text",class:"form-control",placeholder:"已套用優惠券",disabled:""},pe={class:"input-group-append"},fe=["disabled"],_e={key:0,class:"fas fa-spinner fa-pulse"},he={key:1,class:"fs-5 text-end fw-bold mb-4"},be={key:0,class:"col-12 col-lg-6 bg-white p-5"},ge=e("h2",{class:"mb-6"},"訂購資訊",-1),ve={class:"mb-3"},ye=e("label",{for:"email",class:"form-label"},"Email",-1),ke={class:"mb-3"},Ce=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),Ve={class:"mb-3"},we=e("label",{for:"tel",class:"form-label"},"收件人手機",-1),Te={class:"mb-3"},xe=e("label",{for:"address",class:"form-label"},"收件人地址",-1),Se={class:"mb-3"},Le=e("label",{for:"message",class:"form-label"},"留言",-1),Ee=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-primary py-3 px-5 text-gray-dark w-100"},"送出訂單")],-1),Pe={class:"col-12 d-flex flex-column justify-content-center align-items-center my-5"},Ue=e("p",null,[e("i",{class:"fa-solid fa-cart-shopping mb-2 me-2 fs-5"}),y("購物車內沒有商品")],-1);function Fe(s,o,Ne,Re,l,r){const T=c("VueLoading"),x=c("TimeLine"),u=c("VField"),p=c("ErrorMessage"),S=c("VForm"),L=c("RecommendSwiper");return i(),n(h,null,[d(T,{active:l.isLoading},{default:k(()=>[B]),_:1},8,["active"]),e("main",null,[e("section",I,[e("div",D,[e("div",M,[d(x,{step:l.step},null,8,["step"])]),e("div",O,[e("div",H,[z,s.carts?(i(),n("ul",$,[(i(!0),n(h,null,N(s.carts,t=>(i(),n("li",{class:"product-item row align-items-center gx-4 border-bottom mb-6 pb-6",key:t.id},[e("div",G,[e("img",{src:t.product.imageUrl,alt:t.product.title,class:"object-fix-cover w-100",style:{"max-height":"150px"}},null,8,J)]),e("div",K,[e("div",Q,[e("h4",W,f(t.product.title),1),e("a",{href:"#",class:"cart-delete d-block ms-4 ms-md-3",onClick:a=>s.delCart(t.id),disabled:t.id===s.loadingItem},[t.id===s.loadingItem?(i(),n("i",Y)):(i(),n("i",Z))],8,X)]),e("div",ee,[e("div",null,[e("p",se,[te,y(f(r.priceFormat(t.product.price)),1)])]),e("div",null,[e("div",oe,[e("button",{type:"button",class:"btn text-dark p-0",onClick:a=>r.updateProduct("remove",t)},ie,8,le),g(e("input",{type:"number","onUpdate:modelValue":a=>t.qty=a,class:"btn input-num"},null,8,ne),[[v,t.qty]]),e("button",{class:"btn text-dark p-0",type:"button",onClick:a=>r.updateProduct("add",t)},ce,8,de)])])])])]))),128))])):b("",!0),e("div",me,[s.final_total!==s.total?(i(),n("input",ue)):g((i(),n("input",{key:1,type:"text",class:"form-control","onUpdate:modelValue":o[0]||(o[0]=t=>l.couponCode=t),placeholder:"請輸入優惠券"},null,512)),[[v,l.couponCode]]),e("div",pe,[e("button",{class:"btn btn-outline-primary text-gray-dark",disabled:s.final_total!==s.total||s.loadingItem!="",type:"button",onClick:o[1]||(o[1]=(...t)=>r.addCouponCode&&r.addCouponCode(...t))},[s.loadingItem!=""?(i(),n("i",_e)):b("",!0),y(" 套用優惠碼 ")],8,fe)])]),e("p",{class:m(["fs-5 text-end fw-bold",s.final_total!==s.total?"text-muted text-decoration-line-through":""])},f(`總計金額：NT$ ${r.priceFormat(s.total)}`),3),s.final_total!==s.total?(i(),n("p",he,f(`折扣後金額：NT$ ${r.priceFormat(s.final_total)}`),1)):b("",!0)]),s.carts&&s.carts.length>0?(i(),n("div",be,[ge,d(S,{ref:"form",onSubmit:r.createOrder},{default:k(({errors:t})=>[e("div",ve,[ye,d(u,{id:"email",name:"email",type:"email",class:m(["form-control",{"is-invalid":t.email}]),placeholder:"請輸入 Email",modelValue:l.form.user.email,"onUpdate:modelValue":o[2]||(o[2]=a=>l.form.user.email=a),rules:"email|required"},null,8,["class","modelValue"]),d(p,{name:"email",class:"invalid-feedback"})]),e("div",ke,[Ce,d(u,{id:"name",name:"姓名",type:"text",class:m(["form-control",{"is-invalid":t.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:l.form.user.name,"onUpdate:modelValue":o[3]||(o[3]=a=>l.form.user.name=a)},null,8,["class","modelValue"]),d(p,{name:"姓名",class:"invalid-feedback"})]),e("div",Ve,[we,d(u,{id:"tel",name:"電話",type:"tel",class:m(["form-control",{"is-invalid":t.電話}]),placeholder:"請輸入電話",modelValue:l.form.user.tel,"onUpdate:modelValue":o[4]||(o[4]=a=>l.form.user.tel=a),rules:r.isPhone},null,8,["class","modelValue","rules"]),d(p,{name:"電話",class:"invalid-feedback"})]),e("div",Te,[xe,d(u,{id:"address",name:"地址",type:"text",class:m(["form-control",{"is-invalid":t.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:l.form.user.address,"onUpdate:modelValue":o[5]||(o[5]=a=>l.form.user.address=a)},null,8,["class","modelValue"]),d(p,{name:"地址",class:"invalid-feedback"})]),e("div",Se,[Le,g(e("textarea",{id:"message",name:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":o[6]||(o[6]=a=>l.form.message=a)},null,512),[[v,l.form.message]])]),Ee]),_:1},8,["onSubmit"])])):(i(),n(h,{key:1},[e("div",Pe,[Ue,e("a",{class:"btn btn-primary py-3 px-5 text-gray-dark",role:"button",onClick:o[7]||(o[7]=t=>this.$router.push("/products"))},"再去晃晃吧")]),d(L)],64))])])])])],64)}const He=P(j,[["render",Fe]]);export{He as default};
